---
path: 'docs/architecture/toast-modal-system.mdx'
title: 'Toast & Modal System'
description: 'Complete guide to the Skeleton v4 toast and modal systems in SveltyCMS.'
order: 35
icon: 'mdi:message-alert'
author: 'admin'
created: '2025-12-08'
updated: '2025-12-08'
tags:
  - 'architecture'
  - 'ui'
  - 'skeleton'
  - 'svelte-5'
  - 'modals'
  - 'toasts'
---

# Toast & Modal System

## Overview

SveltyCMS uses Skeleton v4's native toast and modal systems with clean Svelte 5 patterns for notifications and dialogs.

---

## Toast System

### Setup

The toast system uses the **Singleton Pattern** recommended by Skeleton v4.

1. **Store**: A shared `toaster` instance is exported from the main store `src/stores/store.svelte.ts`.
2. **Layout**: The `<Toast.Group>` component is mounted in the root layout (`src/routes/+layout.svelte`) and connected to the `toaster` instance.

#### 1. Store Definition (`src/stores/store.svelte.ts`)

```typescript
import { createToaster } from '@skeletonlabs/skeleton-svelte';

export const toaster = createToaster();
```

#### 2. Layout Implementation (`src/routes/+layout.svelte`)

```svelte
<script>
	import { Toast } from '@skeletonlabs/skeleton-svelte';
	import { toaster } from '@stores/store.svelte';
</script>

<!-- Add to the root of your layout -->
<Toast.Group {toaster}>
	{#snippet children(toast)}
		<Toast {toast}>
			<Toast.Message>
				<Toast.Title>{toast.title}</Toast.Title>
				<Toast.Description>{toast.description}</Toast.Description>
			</Toast.Message>
			<Toast.CloseTrigger />
		</Toast>
	{/snippet}
</Toast.Group>
```

### Usage

Import the `toaster` instance anywhere in your application (components or .ts files) to trigger notifications.

```typescript
import { toaster } from '@stores/toaster';

// Simple toast
toaster.success({ description: 'Operation successful!' });
toaster.error({ description: 'Something went wrong' });

// With Title
toaster.info({
	title: 'Update Available',
	description: 'A new version is available for download.'
});

// Available methods:
// toaster.success(props)
// toaster.error(props)
// toaster.warning(props)
// toaster.info(props)
```

### API Reference

The `toaster` instance provides standard methods that accept `ToastProps`:

```typescript
interface ToastProps {
	title?: string;
	description?: string;
	duration?: number; // ms
	// ... specialized props
}
```

---

## Modal System

### Architecture

The modal system uses a centralized state manager (`modalState.svelte.ts`) that handles:

- Modal rendering
- Component lifecycle
- Response callbacks

### Setup

Modals are rendered in the root layout:

```svelte
<script>
  import { modalState } from '@utils/modalState.svelte';
</script>

{#if modalState.isOpen && modalState.active}
  <div class="fixed inset-0 z-999 flex items-center justify-center bg-black/50 backdrop-blur-sm">
    {@const ModalComponent = modalState.active.component}
    <ModalComponent
      {...modalState.active.props}
      close={(result?: any) => modalState.close(result)}
    />
  </div>
{/if}
```

### Creating a Modal Component

Modal components receive a `close` prop and any custom props:

```svelte
<!-- MyModal.svelte -->
<script lang="ts">
	import * as m from '@src/paraglide/messages';

	interface Props {
		title?: string;
		initialValue?: string;
		close?: (result?: any) => void;
	}

	const { title = 'Default Title', initialValue = '', close }: Props = $props();

	let value = $state(initialValue);

	function handleSubmit() {
		close?.({ value, confirmed: true });
	}

	function handleCancel() {
		close?.({ confirmed: false });
	}
</script>

<div class="card p-4 w-modal shadow-xl space-y-4">
	<header class="text-2xl font-bold">{title}</header>

	<input class="input" type="text" bind:value />

	<footer class="flex justify-end gap-2">
		<button class="btn preset-ghost" onclick={handleCancel}>
			{m.button_cancel()}
		</button>
		<button class="btn preset-filled-primary" onclick={handleSubmit}>
			{m.button_save()}
		</button>
	</footer>
</div>
```

### Triggering Modals

```typescript
import { modalState } from '@utils/modalState.svelte';
import MyModal from './MyModal.svelte';

// Simple modal
modalState.trigger(
	MyModal,
	{
		title: 'Edit Item',
		initialValue: 'Current value'
	},
	(result) => {
		if (result?.confirmed) {
			console.log('New value:', result.value);
		}
	}
);
```

### Helper Functions

For common modal patterns, use the helper functions:

```typescript
import { showConfirm, showScheduleModal, showCloneModal } from '@utils/modalState.svelte';

// Confirmation dialog
showConfirm({
	title: 'Delete Item',
	body: 'Are you sure you want to delete this item?',
	onConfirm: async () => {
		await deleteItem();
	},
	onCancel: () => {
		console.log('Cancelled');
	}
});

// Schedule modal
showScheduleModal({
	initialAction: 'publish',
	onSchedule: (date, action) => {
		console.log(`Scheduled ${action} for ${date}`);
	}
});

// Clone modal
showCloneModal({
	count: 3,
	onConfirm: async () => {
		await cloneItems();
	}
});
```

---

## Best Practices

### Toasts

1. **Keep messages concise** - Users should understand at a glance
2. **Use appropriate types** - Match the semantic meaning
3. **Avoid toast spam** - Don't show multiple toasts for the same action

```typescript
// ✅ Good
showToast('Entry saved', 'success');

// ❌ Bad
showToast('The entry has been successfully saved to the database and is now available for viewing', 'success');
```

### Modals

1. **Accept `close` prop** - Always include in your Props interface
2. **Use ParaglideJS** - Import translations for all text
3. **Validate before closing** - Check form validity before calling `close()`
4. **Return meaningful data** - Pass useful data back via `close(result)`

```typescript
// ✅ Good
interface Props {
	close?: (result?: { confirmed: boolean; data?: any }) => void;
}

function handleSubmit() {
	if (!validateForm()) return;
	close?.({ confirmed: true, data: formData });
}

// ❌ Bad
function handleSubmit() {
	close?.(); // No data returned
}
```

---

## Migration from Legacy Code

If you encounter old modal code:

```typescript
// ❌ Old pattern (Skeleton v2)
const modalStore = getModalStore();
if ($modalStore[0]?.response) {
	$modalStore[0].response(data);
}
modalStore.close();

// ✅ New pattern (Skeleton v4)
const { close }: Props = $props();
close?.(data);
```

---

## API Reference

### modalState

```typescript
class ModalState {
	// Current active modal
	active: ModalStateItem | null;

	// Check if modal is open
	get isOpen(): boolean;

	// Open a modal
	trigger(component: Component, props?: Record<string, any>, onClose?: (result?: any) => void): void;

	// Close the modal
	close(result?: any): void;

	// Force close without callback
	clear(): void;
}
```

### Helper Functions

```typescript
// Confirmation dialog
showConfirm(options: {
  title: string;
  body: string;
  confirmText?: string;
  cancelText?: string;
  onConfirm: () => void | Promise<void>;
  onCancel?: () => void | Promise<void>;
}): void;

// Schedule modal
showScheduleModal(options: {
  initialAction?: string;
  onSchedule: (date: Date, action: string) => void | Promise<void>;
}): void;

// Clone modal
showCloneModal(options: {
  count: number;
  onConfirm: () => void | Promise<void>;
}): void;
```

---

## Examples

See these files for complete examples:

- `src/routes/setup/WelcomeModal.svelte` - Simple confirmation
- `src/components/collectionDisplay/ScheduleModal.svelte` - Form with validation
- `src/routes/(app)/user/components/ModalEditAvatar.svelte` - File upload modal

---

## Related Documents

- [State Management](./state-management.mdx)
- [Code Structure](./code-structure.mdx)
- [Initialization Workflow](./initialization-workflow.mdx)
